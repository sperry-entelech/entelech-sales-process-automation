<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entelech Sales Process Automation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .process-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .revenue-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .automation-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .sidebar {
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .sidebar h4 {
            color: #ecf0f1;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .nav-item {
            margin-bottom: 10px;
        }
        
        .nav-link {
            color: #bdc3c7 !important;
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: rgba(255,255,255,0.1);
            color: white !important;
        }
        
        .activity-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }
        
        .pending-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .pending-item.urgent {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .workflow-status {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-qualified { background: #d1ecf1; color: #0c5460; }
        .status-approved { background: #d4edda; color: #155724; }
        .status-executed { background: #d1ecf1; color: #0c5460; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-completed { background: #d4edda; color: #155724; }
        
        .quick-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        
        .quick-action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <h4><i class="fas fa-rocket"></i> Sales Automation</h4>
                <nav class="nav nav-pills flex-column">
                    <a class="nav-link active" href="#" data-section="overview">
                        <i class="fas fa-tachometer-alt"></i> Overview
                    </a>
                    <a class="nav-link" href="#" data-section="discovery">
                        <i class="fas fa-phone"></i> Discovery Calls
                    </a>
                    <a class="nav-link" href="#" data-section="sows">
                        <i class="fas fa-file-contract"></i> SOWs
                    </a>
                    <a class="nav-link" href="#" data-section="contracts">
                        <i class="fas fa-handshake"></i> Contracts
                    </a>
                    <a class="nav-link" href="#" data-section="projects">
                        <i class="fas fa-project-diagram"></i> Project Kickoffs
                    </a>
                    <a class="nav-link" href="#" data-section="workflow">
                        <i class="fas fa-cogs"></i> Workflow Status
                    </a>
                </nav>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-10">
                <div class="container-fluid py-4">
                    
                    <!-- Header -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h1><i class="fas fa-chart-line"></i> Sales Process Dashboard</h1>
                            <p class="text-muted">End-to-end sales automation from discovery to project kickoff</p>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showDiscoveryForm()">
                                <i class="fas fa-plus"></i> New Discovery Call
                            </button>
                        </div>
                    </div>
                    
                    <!-- Overview Section -->
                    <div id="overview-section">
                        
                        <!-- Key Metrics -->
                        <div class="row">
                            <div class="col-md-3">
                                <div class="metric-card">
                                    <div class="metric-value" id="total-calls">-</div>
                                    <div class="metric-label">Discovery Calls</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card process-card">
                                    <div class="metric-value" id="qualified-leads">-</div>
                                    <div class="metric-label">Qualified Leads</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card revenue-card">
                                    <div class="metric-value" id="closed-revenue">-</div>
                                    <div class="metric-label">Closed Revenue</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card automation-card">
                                    <div class="metric-value" id="conversion-rate">-</div>
                                    <div class="metric-label">Conversion Rate</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Charts and Activity -->
                        <div class="row">
                            <div class="col-md-8">
                                <div class="chart-container">
                                    <h5><i class="fas fa-funnel-dollar"></i> Sales Process Funnel</h5>
                                    <canvas id="funnel-chart"></canvas>
                                </div>
                                
                                <div class="chart-container">
                                    <h5><i class="fas fa-chart-bar"></i> Automation Efficiency</h5>
                                    <canvas id="automation-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <!-- Recent Activity -->
                                <div class="chart-container">
                                    <h5><i class="fas fa-clock"></i> Recent Activity</h5>
                                    <div id="recent-activity">
                                        <div class="text-center">Loading...</div>
                                    </div>
                                </div>
                                
                                <!-- Pending Items -->
                                <div class="chart-container">
                                    <h5><i class="fas fa-exclamation-triangle"></i> Items Requiring Attention</h5>
                                    <div id="pending-items">
                                        <div class="text-center">Loading...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Discovery Calls Section -->
                    <div id="discovery-section" style="display: none;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="chart-container">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5><i class="fas fa-phone"></i> Discovery Calls Management</h5>
                                        <div>
                                            <select class="form-select" id="discovery-status-filter">
                                                <option value="">All Statuses</option>
                                                <option value="qualified">Qualified</option>
                                                <option value="nurture">Nurture</option>
                                                <option value="pending_review">Pending Review</option>
                                                <option value="disqualified">Disqualified</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="discovery-calls-table"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SOWs Section -->
                    <div id="sows-section" style="display: none;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="chart-container">
                                    <h5><i class="fas fa-file-contract"></i> Statement of Work Management</h5>
                                    <div id="sows-table"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contracts Section -->
                    <div id="contracts-section" style="display: none;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="chart-container">
                                    <h5><i class="fas fa-handshake"></i> Contract Management</h5>
                                    <div id="contracts-table"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Projects Section -->
                    <div id="projects-section" style="display: none;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="chart-container">
                                    <h5><i class="fas fa-project-diagram"></i> Project Kickoff Management</h5>
                                    <div id="projects-table"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Workflow Section -->
                    <div id="workflow-section" style="display: none;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="chart-container">
                                    <h5><i class="fas fa-cogs"></i> Workflow Automation Status</h5>
                                    <div id="workflow-logs"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="btn btn-primary quick-action-btn" onclick="showDiscoveryForm()" title="New Discovery Call">
            <i class="fas fa-phone"></i>
        </button>
        <button class="btn btn-success quick-action-btn" onclick="refreshData()" title="Refresh Data">
            <i class="fas fa-sync"></i>
        </button>
    </div>
    
    <!-- Discovery Call Modal -->
    <div class="modal fade" id="discoveryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Discovery Call</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="discovery-form">
                        <!-- Company Information -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Company Name *</label>
                                    <input type="text" class="form-control" name="company_name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Industry *</label>
                                    <input type="text" class="form-control" name="industry" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Company Size *</label>
                                    <select class="form-select" name="company_size" required>
                                        <option value="">Select Size</option>
                                        <option value="1-10">1-10 employees</option>
                                        <option value="11-50">11-50 employees</option>
                                        <option value="51-200">51-200 employees</option>
                                        <option value="201-500">201-500 employees</option>
                                        <option value="501-1000">501-1000 employees</option>
                                        <option value="1000+">1000+ employees</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Annual Revenue</label>
                                    <select class="form-select" name="annual_revenue">
                                        <option value="not_disclosed">Not Disclosed</option>
                                        <option value="under_1m">Under $1M</option>
                                        <option value="1m_5m">$1M - $5M</option>
                                        <option value="5m_25m">$5M - $25M</option>
                                        <option value="25m_100m">$25M - $100M</option>
                                        <option value="100m_plus">$100M+</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact Information -->
                        <h6 class="mt-4 mb-3">Primary Contact</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Name *</label>
                                    <input type="text" class="form-control" name="primary_contact_name" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Email *</label>
                                    <input type="email" class="form-control" name="primary_contact_email" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Title *</label>
                                    <input type="text" class="form-control" name="primary_contact_title" required>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Current State Analysis -->
                        <h6 class="mt-4 mb-3">Current State Analysis</h6>
                        <div class="mb-3">
                            <label class="form-label">Current Challenges *</label>
                            <textarea class="form-control" name="current_challenges" rows="3" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Manual Processes *</label>
                            <textarea class="form-control" name="manual_processes" rows="3" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Hours Wasted Weekly</label>
                                    <input type="number" class="form-control" name="time_waste_hours_weekly" min="0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Estimated Cost Inefficiency ($)</label>
                                    <input type="number" class="form-control" name="estimated_cost_inefficiency" min="0" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Team Size Affected</label>
                                    <input type="number" class="form-control" name="team_size_affected" min="0">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Requirements & Goals -->
                        <h6 class="mt-4 mb-3">Requirements & Goals</h6>
                        <div class="mb-3">
                            <label class="form-label">Primary Objectives *</label>
                            <textarea class="form-control" name="primary_objectives" rows="3" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Success Metrics</label>
                            <textarea class="form-control" name="success_metrics" rows="2"></textarea>
                        </div>
                        
                        <!-- Business Case -->
                        <h6 class="mt-4 mb-3">Business Case</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Budget Range</label>
                                    <select class="form-select" name="budget_range">
                                        <option value="not_disclosed">Not Disclosed</option>
                                        <option value="under_25k">Under $25K</option>
                                        <option value="25k_50k">$25K - $50K</option>
                                        <option value="50k_100k">$50K - $100K</option>
                                        <option value="100k_250k">$100K - $250K</option>
                                        <option value="250k_plus">$250K+</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Timeline Urgency</label>
                                    <select class="form-select" name="timeline_urgency">
                                        <option value="immediate">Immediate</option>
                                        <option value="1_month">Within 1 Month</option>
                                        <option value="3_months" selected>Within 3 Months</option>
                                        <option value="6_months">Within 6 Months</option>
                                        <option value="12_months">Within 12 Months</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Call Details -->
                        <h6 class="mt-4 mb-3">Call Details</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Sales Rep</label>
                                    <input type="text" class="form-control" name="sales_rep" value="Alex Thompson">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Call Duration (minutes)</label>
                                    <input type="number" class="form-control" name="call_duration_minutes" value="60">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Next Steps</label>
                            <textarea class="form-control" name="next_steps" rows="2"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Call Notes</label>
                            <textarea class="form-control" name="call_notes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitDiscoveryCall()">Process Discovery Call</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentSection = 'overview';
        let dashboardData = {};
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setupNavigation();
            setupEventListeners();
        });
        
        // Navigation setup
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });
        }
        
        function switchSection(section) {
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('[id$="-section"]').forEach(sectionEl => {
                sectionEl.style.display = 'none';
            });
            document.getElementById(`${section}-section`).style.display = 'block';
            
            currentSection = section;
            
            // Load section-specific data
            loadSectionData(section);
        }
        
        function loadSectionData(section) {
            switch(section) {
                case 'discovery':
                    loadDiscoveryCalls();
                    break;
                case 'sows':
                    loadSOWs();
                    break;
                case 'contracts':
                    loadContracts();
                    break;
                case 'projects':
                    loadProjects();
                    break;
                case 'workflow':
                    loadWorkflowStatus();
                    break;
            }
        }
        
        // Dashboard data loading
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard/overview');
                const data = await response.json();
                dashboardData = data;
                
                updateOverviewMetrics(data);
                updateCharts(data);
                updateRecentActivity(data.recent_activity);
                updatePendingItems(data.pending_items);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        function updateOverviewMetrics(data) {
            document.getElementById('total-calls').textContent = data.key_metrics.total_discovery_calls;
            document.getElementById('qualified-leads').textContent = data.key_metrics.qualified_leads;
            document.getElementById('closed-revenue').textContent = data.key_metrics.closed_revenue;
            document.getElementById('conversion-rate').textContent = 
                (data.conversion_rates.overall_conversion || 0).toFixed(1) + '%';
        }
        
        function updateCharts(data) {
            // Sales funnel chart
            const funnelCtx = document.getElementById('funnel-chart').getContext('2d');
            new Chart(funnelCtx, {
                type: 'bar',
                data: {
                    labels: ['Discovery Calls', 'Qualified', 'SOWs Generated', 'Contracts Executed'],
                    datasets: [{
                        label: 'Count',
                        data: [
                            data.key_metrics.total_discovery_calls,
                            data.key_metrics.qualified_leads,
                            data.key_metrics.sows_generated,
                            data.key_metrics.contracts_executed
                        ],
                        backgroundColor: [
                            '#667eea',
                            '#f093fb',
                            '#4facfe',
                            '#43e97b'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            // Automation efficiency chart
            if (data.automation_efficiency && Object.keys(data.automation_efficiency).length > 0) {
                const automationCtx = document.getElementById('automation-chart').getContext('2d');
                const processTypes = Object.keys(data.automation_efficiency);
                const successRates = processTypes.map(type => data.automation_efficiency[type].success_rate);
                
                new Chart(automationCtx, {
                    type: 'doughnut',
                    data: {
                        labels: processTypes.map(type => type.replace('_', ' ').toUpperCase()),
                        datasets: [{
                            data: successRates,
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }
        
        function updateRecentActivity(activities) {
            const container = document.getElementById('recent-activity');
            
            if (!activities || activities.length === 0) {
                container.innerHTML = '<p class="text-muted">No recent activity</p>';
                return;
            }
            
            let html = '';
            activities.forEach(activity => {
                html += `
                    <div class="activity-item">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>${activity.description}</strong>
                                <br><small class="text-muted">${activity.type.replace('_', ' ')}</small>
                            </div>
                            <div>
                                <small>${new Date(activity.timestamp).toLocaleDateString()}</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function updatePendingItems(pending) {
            const container = document.getElementById('pending-items');
            
            let html = '';
            
            if (pending.sows_pending_review > 0) {
                html += `
                    <div class="pending-item">
                        <strong>${pending.sows_pending_review}</strong> SOWs pending review
                    </div>
                `;
            }
            
            if (pending.contracts_pending_signature > 0) {
                html += `
                    <div class="pending-item">
                        <strong>${pending.contracts_pending_signature}</strong> Contracts pending signature
                    </div>
                `;
            }
            
            if (pending.projects_pending_kickoff > 0) {
                html += `
                    <div class="pending-item">
                        <strong>${pending.projects_pending_kickoff}</strong> Projects pending kickoff
                    </div>
                `;
            }
            
            if (pending.overdue_payments > 0) {
                html += `
                    <div class="pending-item urgent">
                        <strong>${pending.overdue_payments}</strong> Overdue payments
                    </div>
                `;
            }
            
            if (html === '') {
                html = '<p class="text-success">All items up to date!</p>';
            }
            
            container.innerHTML = html;
        }
        
        // Section data loading functions
        async function loadDiscoveryCalls() {
            try {
                const status = document.getElementById('discovery-status-filter')?.value || '';
                const response = await fetch(`/api/discovery/calls?status=${status}`);
                const data = await response.json();
                
                displayDiscoveryCalls(data.calls);
            } catch (error) {
                console.error('Error loading discovery calls:', error);
            }
        }
        
        function displayDiscoveryCalls(calls) {
            const container = document.getElementById('discovery-calls-table');
            
            if (!calls || calls.length === 0) {
                container.innerHTML = '<p class="text-muted">No discovery calls found</p>';
                return;
            }
            
            let html = `
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Contact</th>
                            <th>Industry</th>
                            <th>Score</th>
                            <th>Status</th>
                            <th>Call Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            calls.forEach(call => {
                html += `
                    <tr>
                        <td><strong>${call.company_name}</strong></td>
                        <td>${call.primary_contact_name}</td>
                        <td>${call.industry}</td>
                        <td><span class="badge bg-primary">${call.overall_qualification_score}</span></td>
                        <td><span class="status-badge status-${call.qualified_status}">${call.qualified_status.replace('_', ' ')}</span></td>
                        <td>${new Date(call.call_date).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewCallDetails(${call.call_id})">
                                View
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        async function loadSOWs() {
            try {
                const response = await fetch('/api/sows/list');
                const data = await response.json();
                
                displaySOWs(data.sows);
            } catch (error) {
                console.error('Error loading SOWs:', error);
            }
        }
        
        function displaySOWs(sows) {
            const container = document.getElementById('sows-table');
            
            if (!sows || sows.length === 0) {
                container.innerHTML = '<p class="text-muted">No SOWs found</p>';
                return;
            }
            
            let html = `
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Project Title</th>
                            <th>Company</th>
                            <th>Value</th>
                            <th>Timeline</th>
                            <th>Status</th>
                            <th>Generated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            sows.forEach(sow => {
                html += `
                    <tr>
                        <td><strong>${sow.project_title}</strong></td>
                        <td>${sow.company_name}</td>
                        <td>$${sow.total_project_cost.toLocaleString()}</td>
                        <td>${sow.timeline_weeks} weeks</td>
                        <td><span class="status-badge status-${sow.sow_status}">${sow.sow_status}</span></td>
                        <td>${new Date(sow.generated_at).toLocaleDateString()}</td>
                        <td>
                            ${sow.sow_status === 'review' ? 
                                `<button class="btn btn-sm btn-success" onclick="approveSOW(${sow.sow_id})">Approve</button>` :
                                `<button class="btn btn-sm btn-outline-primary" onclick="viewSOW(${sow.sow_id})">View</button>`
                            }
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        async function loadContracts() {
            try {
                const response = await fetch('/api/contracts/list');
                const data = await response.json();
                
                displayContracts(data.contracts);
            } catch (error) {
                console.error('Error loading contracts:', error);
            }
        }
        
        function displayContracts(contracts) {
            const container = document.getElementById('contracts-table');
            
            if (!contracts || contracts.length === 0) {
                container.innerHTML = '<p class="text-muted">No contracts found</p>';
                return;
            }
            
            let html = `
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Contract #</th>
                            <th>Client</th>
                            <th>Value</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            contracts.forEach(contract => {
                html += `
                    <tr>
                        <td><strong>${contract.contract_number}</strong></td>
                        <td>${contract.client_legal_name}</td>
                        <td>$${contract.total_contract_value.toLocaleString()}</td>
                        <td><span class="status-badge status-${contract.contract_status.replace('_', '')}">${contract.contract_status.replace('_', ' ')}</span></td>
                        <td>${new Date(contract.created_at).toLocaleDateString()}</td>
                        <td>
                            ${getContractActions(contract)}
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function getContractActions(contract) {
            switch(contract.contract_status) {
                case 'draft':
                    return `<button class="btn btn-sm btn-primary" onclick="sendContract(${contract.contract_id})">Send</button>`;
                case 'sent_for_signature':
                    return `<button class="btn btn-sm btn-success" onclick="executeContract(${contract.contract_id})">Mark Executed</button>`;
                case 'fully_executed':
                    return `<button class="btn btn-sm btn-outline-primary" onclick="viewContract(${contract.contract_id})">View</button>`;
                default:
                    return `<button class="btn btn-sm btn-outline-primary" onclick="viewContract(${contract.contract_id})">View</button>`;
            }
        }
        
        // Action functions
        function showDiscoveryForm() {
            const modal = new bootstrap.Modal(document.getElementById('discoveryModal'));
            modal.show();
        }
        
        async function submitDiscoveryCall() {
            const form = document.getElementById('discovery-form');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch('/api/discovery/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Discovery call processed successfully!');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('discoveryModal'));
                    modal.hide();
                    form.reset();
                    refreshData();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error submitting discovery call: ' + error.message);
            }
        }
        
        async function approveSOW(sowId) {
            if (!confirm('Approve this SOW and generate contract?')) return;
            
            try {
                const response = await fetch(`/api/sows/${sowId}/approve`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('SOW approved and contract generated!');
                    loadSOWs();
                    loadContracts();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error approving SOW: ' + error.message);
            }
        }
        
        async function sendContract(contractId) {
            if (!confirm('Send this contract for signature?')) return;
            
            try {
                const response = await fetch(`/api/contracts/${contractId}/send`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Contract sent for signature!');
                    loadContracts();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error sending contract: ' + error.message);
            }
        }
        
        async function executeContract(contractId) {
            if (!confirm('Mark this contract as fully executed? This will setup payment processing and trigger project kickoff.')) return;
            
            try {
                const response = await fetch(`/api/contracts/${contractId}/execute`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Contract executed! Payment processing setup and project kickoff initiated.');
                    loadContracts();
                    loadProjects();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error executing contract: ' + error.message);
            }
        }
        
        function refreshData() {
            loadDashboardData();
            if (currentSection !== 'overview') {
                loadSectionData(currentSection);
            }
        }
        
        // Event listeners
        function setupEventListeners() {
            // Discovery status filter
            const statusFilter = document.getElementById('discovery-status-filter');
            if (statusFilter) {
                statusFilter.addEventListener('change', loadDiscoveryCalls);
            }
        }
        
        // Placeholder functions for detailed views
        function viewCallDetails(callId) {
            alert(`View call details for ID: ${callId}`);
        }
        
        function viewSOW(sowId) {
            alert(`View SOW details for ID: ${sowId}`);
        }
        
        function viewContract(contractId) {
            alert(`View contract details for ID: ${contractId}`);
        }
        
        async function loadProjects() {
            // Placeholder - implement project loading
            document.getElementById('projects-table').innerHTML = '<p class="text-muted">Projects loading...</p>';
        }
        
        async function loadWorkflowStatus() {
            // Placeholder - implement workflow status loading
            document.getElementById('workflow-logs').innerHTML = '<p class="text-muted">Workflow status loading...</p>';
        }
    </script>
</body>
</html>